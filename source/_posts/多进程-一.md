---
title: 多进程(一)
date: 2018-06-21 18:02:25
tags: [Android]
---

Reference：《Android开发艺术探索》，作者：任玉刚
多进程基础以及一些名词
<!-- more -->
###### IPC

进程间通信或者跨进程通信，全称：Inter-Process Communication。

在操作系统中，线程是CPU调度的最小单元，同时线程是一种有限的系统资源。而进程一般指一个执行单元。一个进程可以包含做个线程。最简单的情况下，一个进程中可以只有一个线程，即主线程，在Android中，主线程也叫UI线程。

IPC不是Android中所独有的，任何一个操作系统都需要有相应的IPC机制，比如windows上可以通过剪贴板、管道和邮槽等来进行进程间通信；linux上可以通过命名管道、共享内容、信号量等来进行进程间通信。Android是基于Linux内核的移动操作系统，它的进程间通信方式没有完全继承自linux，在Android中可以通过Binder轻松实现进程间通信。除了Binder，Android还支持Socket。

###### 开启多进程

** 指定process属性 **

正常情况下，在Android中多进程是指一个应用中存在多个进程的情况，因此先忽略多个应用多进程的情况。首先在Android中使用多进程只有一种方式：在AndroidMenifest文件中指定`android:process`属性，除此之外还有一种非常规的方式，通过JNI在native层fork一个新的进程。也就是说我们无法给一个线程或者一个实体类指定其运行时所在的进程。

``` xml
<activity
	android:name=".ui.ActivityOne"
	android:process=":remote" />
<activity
	android:name=".ui.ActivityTwo"
	android:process="com.huangyuanlove.xuan" />
<activity
	android:name=".ui.ActivityThree" />
```

假如当前应用包名为`com.huangyuanlove.ipc`，当`ActivityOne`启动时，系统会为它创建一个单独的进程，进程名为`com.huangyuanlove.ipc:remote`，当`ActivityTwo`启动时，系统也会为它创建一个进程，进程名为：`com.huangyuanlove.xuan`，当然`ActivityThree`是运行在默认进程中，默认进程是包名。

** :name 和 全限定名的区别 **

* “:”的含义是在当前进程名的前面附加上包名(ActivityOne)，全限定名并不会附加包名。
* 以":"开头的进程属于当前应用的私有进程，其他应用的组件不可以和它跑在同一个进程中，其他不以":"开头的进程属于全局进程，其他应用通过ShareUID方式可以和它跑在同一个进程中。

​     Android会为每一个应用分配一个UID，具有相同UID的应用才能共享数据，需要注意的是，两个应用通过ShareUID跑在同一个进程中是有要求的，需要这两个应用有相同的ShareUID并且签名相同才可以。这种情况下，他们可以互相访问对方的私有数据，还可以共享内存数据，或者说它们看起来就像是一个应用的两个部分。

###### 带来的问题

* 静态成员和单例模式凉凉
* 线程同步锁机制凉凉
* SharedPreferences可靠性凉凉
* Application会创建多次

因为开启多进程之后，就不再是同一个内存区域，所以带来第一个问题，第二个问题也是同样，不在同一个内存区域，无论是对象锁还是全局锁可靠性基本就凉了。第三个问题和多进程写sp一样，第四个问题也是显而易见的，系统在创建新进程的时候会同时分配独立的虚拟机，所以这个过程就是启动一个应用的过程。

###### Parcelable 和 Serializable

这个自己玩

###### binder

